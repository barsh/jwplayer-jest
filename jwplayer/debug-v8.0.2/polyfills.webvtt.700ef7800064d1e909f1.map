{"version":3,"sources":["webpack:///./src/js/polyfills/webvtt.js"],"names":["ParsingError","errorData","message","name","code","prototype","Object","create","Error","constructor","Errors","BadSignature","BadTimeStamp","parseTimeStamp","input","computeSeconds","h","m","s","f","match","replace","Settings","values","set","k","v","get","dflt","defaultKey","has","alt","a","n","length","integer","test","parseInt","percent","parseFloat","ESCAPE","TAG_NAME","c","i","b","u","ruby","rt","lang","TAG_ANNOTATION","NEEDS_PARENT","parseContent","window","nextToken","consume","result","substr","unescape1","e","unescape","shouldAdd","current","element","localName","createElement","type","annotation","tagName","document","trim","rootDiv","t","tagStack","pop","parentNode","ts","node","createProcessingInstruction","appendChild","className","push","createTextNode","strongRTLRanges","isStrongRTLChar","charCode","currentRange","pushNodes","nodeStack","childNodes","nextTextNode","text","textContent","innerText","determineBidi","cueDiv","charCodeAt","computeLinePos","cue","line","snapToLines","track","textTrackList","mediaElement","trackList","count","mode","StyleBox","applyStyles","styles","div","prop","hasOwnProperty","style","formatStyle","val","unit","CueStyleBox","call","textShadow","position","paddingLeft","paddingRight","top","bottom","display","writingMode","vertical","unicodeBidi","textAlign","align","whiteSpace","direction","textPos","size","Math","max","min","width","height","move","box","left","right","BoxPosition","obj","lh","offsetHeight","offsetWidth","offsetTop","rects","getClientRects","getBoundingClientRect","lineHeight","undefined","ceil","axis","toMove","overlaps","b2","overlapsAny","boxes","within","container","overlapsOppositeAxis","intersectPercentage","x","y","intersectArea","toCSSCompatValues","reference","getSimpleBoxPosition","ret","moveBoxToLinePosition","styleBox","containerBox","boxPositions","numLinesOfText","findBestPosition","bestPosition","specifiedPosition","percentage","p","boxPosition","linePos","step","maxLines","floor","round","maxPosition","initialAxis","abs","textHeight","reverse","calculatedPercentage","lineAlign","WebVTT","StringDecoder","decode","data","decodeURIComponent","encodeURIComponent","convertCueToDOMTree","cuetext","CUE_BACKGROUND_PADDING","shouldCompute","cues","hasBeenReset","displayState","processCues","overlay","updateBoxPosition","firstChild","removeChild","paddedOverlay","margin","currentNumOfLines","reduce","totalLines","split","j","webVttExport"],"mappings":"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","file":"polyfills.webvtt.js","sourcesContent":["/**\r\n* Copyright 2013 vtt.js Contributors\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n*/\r\n\r\n/* eslint no-unused-expressions: 0, no-nested-ternary: 0 */\r\n\r\n// Creates a new ParserError object from an errorData object. The errorData\r\n// object should have default code and message properties. The default message\r\n// property can be overriden by passing in a message parameter.\r\n// See ParsingError.Errors below for acceptable errors.\r\nfunction ParsingError(errorData, message) {\r\n    this.name = 'ParsingError';\r\n    this.code = errorData.code;\r\n    this.message = message || errorData.message;\r\n}\r\n\r\nParsingError.prototype = Object.create(Error.prototype);\r\nParsingError.prototype.constructor = ParsingError;\r\n\r\n// ParsingError metadata for acceptable ParsingErrors.\r\nParsingError.Errors = {\r\n    BadSignature: {\r\n        code: 0,\r\n        message: 'Malformed WebVTT signature.'\r\n    },\r\n    BadTimeStamp: {\r\n        code: 1,\r\n        message: 'Malformed time stamp.'\r\n    }\r\n};\r\n\r\n// Try to parse input as a time stamp.\r\nfunction parseTimeStamp(input) {\r\n\r\n    function computeSeconds(h, m, s, f) {\r\n        return (h | 0) * 3600 + (m | 0) * 60 + (s | 0) + (f | 0) / 1000;\r\n    }\r\n\r\n    var m = input.match(/^(\\d+):(\\d{2})(:\\d{2})?\\.(\\d{3})/);\r\n    if (!m) {\r\n        return null;\r\n    }\r\n\r\n    if (m[3]) {\r\n        // Timestamp takes the form of [hours]:[minutes]:[seconds].[milliseconds]\r\n        return computeSeconds(m[1], m[2], m[3].replace(':', ''), m[4]);\r\n    } else if (m[1] > 59) {\r\n        // Timestamp takes the form of [hours]:[minutes].[milliseconds]\r\n        // First position is hours as it's over 59.\r\n        return computeSeconds(m[1], m[2], 0, m[4]);\r\n    }\r\n    // Timestamp takes the form of [minutes]:[seconds].[milliseconds]\r\n    return computeSeconds(0, m[1], m[2], m[4]);\r\n}\r\n\r\n// A settings object holds key/value pairs and will ignore anything but the first\r\n// assignment to a specific key.\r\nfunction Settings() {\r\n    this.values = Object.create(null);\r\n}\r\n\r\nSettings.prototype = {\r\n    // Only accept the first assignment to any key.\r\n    set: function (k, v) {\r\n        if (!this.get(k) && v !== '') {\r\n            this.values[k] = v;\r\n        }\r\n    },\r\n    // Return the value for a key, or a default value.\r\n    // If 'defaultKey' is passed then 'dflt' is assumed to be an object with\r\n    // a number of possible default values as properties where 'defaultKey' is\r\n    // the key of the property that will be chosen; otherwise it's assumed to be\r\n    // a single value.\r\n    get: function (k, dflt, defaultKey) {\r\n        if (defaultKey) {\r\n            return this.has(k) ? this.values[k] : dflt[defaultKey];\r\n        }\r\n        return this.has(k) ? this.values[k] : dflt;\r\n    },\r\n    // Check whether we have a value for a key.\r\n    has: function (k) {\r\n        return k in this.values;\r\n    },\r\n    // Accept a setting if its one of the given alternatives.\r\n    alt: function (k, v, a) {\r\n        for (var n = 0; n < a.length; ++n) {\r\n            if (v === a[n]) {\r\n                this.set(k, v);\r\n                break;\r\n            }\r\n        }\r\n    },\r\n    // Accept a setting if its a valid (signed) integer.\r\n    integer: function (k, v) {\r\n        if (/^-?\\d+$/.test(v)) { // integer\r\n            this.set(k, parseInt(v, 10));\r\n        }\r\n    },\r\n    // Accept a setting if its a valid percentage.\r\n    percent: function (k, v) {\r\n        if ((/^[\\d]{1,3}(\\.[\\d]*)?%$/).test(v)) {\r\n            v = parseFloat(v);\r\n            if (v >= 0 && v <= 100) {\r\n                this.set(k, v);\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n};\r\n\r\nvar ESCAPE = {\r\n    '&amp;': '&',\r\n    '&lt;': '<',\r\n    '&gt;': '>',\r\n    '&lrm;': '\\u200e',\r\n    '&rlm;': '\\u200f',\r\n    '&nbsp;': '\\u00a0'\r\n};\r\n\r\nvar TAG_NAME = {\r\n    c: 'span',\r\n    i: 'i',\r\n    b: 'b',\r\n    u: 'u',\r\n    ruby: 'ruby',\r\n    rt: 'rt',\r\n    v: 'span',\r\n    lang: 'span'\r\n};\r\n\r\nvar TAG_ANNOTATION = {\r\n    v: 'title',\r\n    lang: 'lang'\r\n};\r\n\r\nvar NEEDS_PARENT = {\r\n    rt: 'ruby'\r\n};\r\n\r\n// Parse content into a document fragment.\r\nfunction parseContent(window, input) {\r\n    function nextToken() {\r\n        // Check for end-of-string.\r\n        if (!input) {\r\n            return null;\r\n        }\r\n\r\n        // Consume 'n' characters from the input.\r\n        function consume(result) {\r\n            input = input.substr(result.length);\r\n            return result;\r\n        }\r\n\r\n        var m = input.match(/^([^<]*)(<[^>]+>?)?/);\r\n        // If there is some text before the next tag, return it, otherwise return\r\n        // the tag.\r\n        return consume(m[1] ? m[1] : m[2]);\r\n    }\r\n\r\n    // Unescape a string 's'.\r\n    function unescape1(e) {\r\n        return ESCAPE[e];\r\n    }\r\n\r\n    function unescape(s) {\r\n        while ((m = s.match(/&(amp|lt|gt|lrm|rlm|nbsp);/))) {\r\n            s = s.replace(m[0], unescape1);\r\n        }\r\n        return s;\r\n    }\r\n\r\n    function shouldAdd(current, element) {\r\n        return !NEEDS_PARENT[element.localName] ||\r\n            NEEDS_PARENT[element.localName] === current.localName;\r\n    }\r\n\r\n    // Create an element for this tag.\r\n    function createElement(type, annotation) {\r\n        var tagName = TAG_NAME[type];\r\n        if (!tagName) {\r\n            return null;\r\n        }\r\n        var element = window.document.createElement(tagName);\r\n        var name = TAG_ANNOTATION[type];\r\n        if (name && annotation) {\r\n            element[name] = annotation.trim();\r\n        }\r\n        return element;\r\n    }\r\n\r\n    var rootDiv = window.document.createElement('div');\r\n    var current = rootDiv;\r\n    var t;\r\n    var tagStack = [];\r\n\r\n    while ((t = nextToken()) !== null) {\r\n        if (t[0] === '<') {\r\n            if (t[1] === '/') {\r\n                // If the closing tag matches, move back up to the parent node.\r\n                if (tagStack.length &&\r\n                    tagStack[tagStack.length - 1] === t.substr(2).replace('>', '')) {\r\n                    tagStack.pop();\r\n                    current = current.parentNode;\r\n                }\r\n                // Otherwise just ignore the end tag.\r\n                continue;\r\n            }\r\n            var ts = parseTimeStamp(t.substr(1, t.length - 2));\r\n            var node;\r\n            if (ts) {\r\n                // Timestamps are lead nodes as well.\r\n                node = window.document.createProcessingInstruction('timestamp', ts);\r\n                current.appendChild(node);\r\n                continue;\r\n            }\r\n            var m = t.match(/^<([^.\\s/0-9>]+)(\\.[^\\s\\\\>]+)?([^>\\\\]+)?(\\\\?)>?$/);\r\n            // If we can't parse the tag, skip to the next tag.\r\n            if (!m) {\r\n                continue;\r\n            }\r\n            // Try to construct an element, and ignore the tag if we couldn't.\r\n            node = createElement(m[1], m[3]);\r\n            if (!node) {\r\n                continue;\r\n            }\r\n            // Determine if the tag should be added based on the context of where it\r\n            // is placed in the cuetext.\r\n            if (!shouldAdd(current, node)) {\r\n                continue;\r\n            }\r\n            // Set the class list (as a list of classes, separated by space).\r\n            if (m[2]) {\r\n                node.className = m[2].substr(1).replace('.', ' ');\r\n            }\r\n            // Append the node to the current node, and enter the scope of the new\r\n            // node.\r\n            tagStack.push(m[1]);\r\n            current.appendChild(node);\r\n            current = node;\r\n            continue;\r\n        }\r\n\r\n        // Text nodes are leaf nodes.\r\n        current.appendChild(window.document.createTextNode(unescape(t)));\r\n    }\r\n\r\n    return rootDiv;\r\n}\r\n\r\n// This is a list of all the Unicode characters that have a strong\r\n// right-to-left category. What this means is that these characters are\r\n// written right-to-left for sure. It was generated by pulling all the strong\r\n// right-to-left characters out of the Unicode data table. That table can\r\n// found at: http://www.unicode.org/Public/UNIDATA/UnicodeData.txt\r\nvar strongRTLRanges = [[0x5be, 0x5be], [0x5c0, 0x5c0], [0x5c3, 0x5c3], [0x5c6, 0x5c6],\r\n    [0x5d0, 0x5ea], [0x5f0, 0x5f4], [0x608, 0x608], [0x60b, 0x60b], [0x60d, 0x60d],\r\n    [0x61b, 0x61b], [0x61e, 0x64a], [0x66d, 0x66f], [0x671, 0x6d5], [0x6e5, 0x6e6],\r\n    [0x6ee, 0x6ef], [0x6fa, 0x70d], [0x70f, 0x710], [0x712, 0x72f], [0x74d, 0x7a5],\r\n    [0x7b1, 0x7b1], [0x7c0, 0x7ea], [0x7f4, 0x7f5], [0x7fa, 0x7fa], [0x800, 0x815],\r\n    [0x81a, 0x81a], [0x824, 0x824], [0x828, 0x828], [0x830, 0x83e], [0x840, 0x858],\r\n    [0x85e, 0x85e], [0x8a0, 0x8a0], [0x8a2, 0x8ac], [0x200f, 0x200f],\r\n    [0xfb1d, 0xfb1d], [0xfb1f, 0xfb28], [0xfb2a, 0xfb36], [0xfb38, 0xfb3c],\r\n    [0xfb3e, 0xfb3e], [0xfb40, 0xfb41], [0xfb43, 0xfb44], [0xfb46, 0xfbc1],\r\n    [0xfbd3, 0xfd3d], [0xfd50, 0xfd8f], [0xfd92, 0xfdc7], [0xfdf0, 0xfdfc],\r\n    [0xfe70, 0xfe74], [0xfe76, 0xfefc], [0x10800, 0x10805], [0x10808, 0x10808],\r\n    [0x1080a, 0x10835], [0x10837, 0x10838], [0x1083c, 0x1083c], [0x1083f, 0x10855],\r\n    [0x10857, 0x1085f], [0x10900, 0x1091b], [0x10920, 0x10939], [0x1093f, 0x1093f],\r\n    [0x10980, 0x109b7], [0x109be, 0x109bf], [0x10a00, 0x10a00], [0x10a10, 0x10a13],\r\n    [0x10a15, 0x10a17], [0x10a19, 0x10a33], [0x10a40, 0x10a47], [0x10a50, 0x10a58],\r\n    [0x10a60, 0x10a7f], [0x10b00, 0x10b35], [0x10b40, 0x10b55], [0x10b58, 0x10b72],\r\n    [0x10b78, 0x10b7f], [0x10c00, 0x10c48], [0x1ee00, 0x1ee03], [0x1ee05, 0x1ee1f],\r\n    [0x1ee21, 0x1ee22], [0x1ee24, 0x1ee24], [0x1ee27, 0x1ee27], [0x1ee29, 0x1ee32],\r\n    [0x1ee34, 0x1ee37], [0x1ee39, 0x1ee39], [0x1ee3b, 0x1ee3b], [0x1ee42, 0x1ee42],\r\n    [0x1ee47, 0x1ee47], [0x1ee49, 0x1ee49], [0x1ee4b, 0x1ee4b], [0x1ee4d, 0x1ee4f],\r\n    [0x1ee51, 0x1ee52], [0x1ee54, 0x1ee54], [0x1ee57, 0x1ee57], [0x1ee59, 0x1ee59],\r\n    [0x1ee5b, 0x1ee5b], [0x1ee5d, 0x1ee5d], [0x1ee5f, 0x1ee5f], [0x1ee61, 0x1ee62],\r\n    [0x1ee64, 0x1ee64], [0x1ee67, 0x1ee6a], [0x1ee6c, 0x1ee72], [0x1ee74, 0x1ee77],\r\n    [0x1ee79, 0x1ee7c], [0x1ee7e, 0x1ee7e], [0x1ee80, 0x1ee89], [0x1ee8b, 0x1ee9b],\r\n    [0x1eea1, 0x1eea3], [0x1eea5, 0x1eea9], [0x1eeab, 0x1eebb], [0x10fffd, 0x10fffd]];\r\n\r\nfunction isStrongRTLChar(charCode) {\r\n    for (var i = 0; i < strongRTLRanges.length; i++) {\r\n        var currentRange = strongRTLRanges[i];\r\n        if (charCode >= currentRange[0] && charCode <= currentRange[1]) {\r\n            return true;\r\n        }\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\nfunction pushNodes(nodeStack, node) {\r\n    for (var i = node.childNodes.length - 1; i >= 0; i--) {\r\n        nodeStack.push(node.childNodes[i]);\r\n    }\r\n}\r\n\r\nfunction nextTextNode(nodeStack) {\r\n    if (!nodeStack || !nodeStack.length) {\r\n        return null;\r\n    }\r\n\r\n    var node = nodeStack.pop();\r\n    var text = node.textContent || node.innerText;\r\n    if (text) {\r\n        // TODO: This should match all unicode type B characters (paragraph\r\n        // separator characters). See issue #115.\r\n        var m = text.match(/^.*(\\n|\\r)/);\r\n        if (m) {\r\n            nodeStack.length = 0;\r\n            return m[0];\r\n        }\r\n        return text;\r\n    }\r\n    if (node.tagName === 'ruby') {\r\n        return nextTextNode(nodeStack);\r\n    }\r\n    if (node.childNodes) {\r\n        pushNodes(nodeStack, node);\r\n        return nextTextNode(nodeStack);\r\n    }\r\n}\r\n\r\nfunction determineBidi(cueDiv) {\r\n    if (!cueDiv || !cueDiv.childNodes) {\r\n        return 'ltr';\r\n    }\r\n\r\n    var nodeStack = [];\r\n    var text;\r\n    var charCode;\r\n\r\n    pushNodes(nodeStack, cueDiv);\r\n    while ((text = nextTextNode(nodeStack))) {\r\n        for (var i = 0; i < text.length; i++) {\r\n            charCode = text.charCodeAt(i);\r\n            if (isStrongRTLChar(charCode)) {\r\n                return 'rtl';\r\n            }\r\n        }\r\n    }\r\n    return 'ltr';\r\n}\r\n\r\nfunction computeLinePos(cue) {\r\n    if (typeof cue.line === 'number' &&\r\n        (cue.snapToLines || (cue.line >= 0 && cue.line <= 100))) {\r\n        return cue.line;\r\n    }\r\n    if (!cue.track || !cue.track.textTrackList || !cue.track.textTrackList.mediaElement) {\r\n        return -1;\r\n    }\r\n    var track = cue.track;\r\n    var trackList = track.textTrackList;\r\n    var count = 0;\r\n    for (var i = 0; i < trackList.length && trackList[i] !== track; i++) {\r\n        if (trackList[i].mode === 'showing') {\r\n            count++;\r\n        }\r\n    }\r\n    return ++count * -1;\r\n}\r\n\r\nfunction StyleBox() {\r\n}\r\n\r\n// Apply styles to a div. If there is no div passed then it defaults to the\r\n// div on 'this'.\r\nStyleBox.prototype.applyStyles = function (styles, div) {\r\n    div = div || this.div;\r\n    for (var prop in styles) {\r\n        if (styles.hasOwnProperty(prop)) {\r\n            div.style[prop] = styles[prop];\r\n        }\r\n    }\r\n};\r\n\r\nStyleBox.prototype.formatStyle = function (val, unit) {\r\n    return val === 0 ? 0 : val + unit;\r\n};\r\n\r\n// Constructs the computed display state of the cue (a div). Places the div\r\n// into the overlay which should be a block level element (usually a div).\r\nfunction CueStyleBox(window, cue) {\r\n\r\n    StyleBox.call(this);\r\n    this.cue = cue;\r\n\r\n    // Parse our cue's text into a DOM tree rooted at 'cueDiv'. This div will\r\n    // have inline positioning and will function as the cue background box.\r\n    this.cueDiv = parseContent(window, cue.text);\r\n    // Added on 6/21/2016 by Evol Greaves: evol@jwplayer.com for styling captions with CSS\r\n    this.cueDiv.className = 'jw-text-track-cue jw-reset';\r\n    var styles = {\r\n        textShadow: '',\r\n        position: 'relative',\r\n        paddingLeft: 0,\r\n        paddingRight: 0,\r\n        top: 0,\r\n        bottom: 0,\r\n        display: 'inline',\r\n        writingMode: cue.vertical === '' ? 'horizontal-tb' : cue.vertical === 'lr' ? 'vertical-lr' : 'vertical-rl',\r\n        unicodeBidi: 'plaintext',\r\n    };\r\n\r\n    this.applyStyles(styles, this.cueDiv);\r\n\r\n    // Create an absolutely positioned div that will be used to position the cue\r\n    // div. Note, all WebVTT cue-setting alignments are equivalent to the CSS\r\n    // mirrors of them except \"middle\" which is \"center\" in CSS.\r\n    this.div = window.document.createElement('div');\r\n    styles = {\r\n        textAlign: cue.align === 'middle' ? 'center' : cue.align,\r\n        whiteSpace: 'pre-line',\r\n        position: 'absolute',\r\n        direction: determineBidi(this.cueDiv),\r\n        writingMode: cue.vertical === '' ? 'horizontal-tb' : cue.vertical === 'lr' ? 'vertical-lr' : 'vertical-rl',\r\n        unicodeBidi: 'plaintext',\r\n    };\r\n\r\n    this.applyStyles(styles);\r\n\r\n    this.div.appendChild(this.cueDiv);\r\n\r\n    // Calculate the distance from the reference edge of the viewport to the text\r\n    // position of the cue box. The reference edge will be resolved later when\r\n    // the box orientation styles are applied.\r\n    var textPos = 0;\r\n    // Modified on 10/05/2016 by Evol Greaves: evol@jwplayer.com.\r\n    // The polyfill used cue.positionAlign to determine whether text should be left,\r\n    // center or right aligned. However, this value is read only after a cue has been created in FF though the\r\n    // spec says this value should be settable. See below link:\r\n    // https://w3c.github.io/webvtt/#ref-for-enumdef-positionalignsetting-1\r\n    // The cue.align property is settable and other browsers use it as the offset from which the cue.position\r\n    // value is applied.\r\n    switch (cue.align) {\r\n        case 'start':\r\n        case 'left':\r\n            textPos = cue.position;\r\n            break;\r\n        case 'middle':\r\n        case 'center':\r\n            textPos = (cue.position === 'auto' ? 50 : cue.position) - (cue.size / 2);\r\n            break;\r\n        case 'end':\r\n        case 'right':\r\n            textPos = cue.position - cue.size;\r\n            break;\r\n        default:\r\n            break;\r\n    }\r\n\r\n    // Added on 8/04/2016 by Evol Greaves: evol@jwplayer.com.\r\n    // Ensures textPos is within the bounds of the cueBox\r\n    textPos = Math.max(Math.min(100, textPos), 0);\r\n\r\n    // Horizontal box orientation; textPos is the distance from the left edge of the\r\n    // area to the left edge of the box and cue.size is the distance extending to\r\n    // the right from there.\r\n    if (cue.vertical === '') {\r\n        this.applyStyles({\r\n            paddingLeft: this.formatStyle(textPos, '%'),\r\n            width: this.formatStyle(cue.size, '%')\r\n        });\r\n        // Vertical box orientation; textPos is the distance from the top edge of the\r\n        // area to the top edge of the box and cue.size is the height extending\r\n        // downwards from there.\r\n    } else {\r\n        this.applyStyles({\r\n            top: this.formatStyle(textPos, '%'),\r\n            height: this.formatStyle(cue.size, '%')\r\n        });\r\n    }\r\n\r\n    this.move = function (box) {\r\n        this.applyStyles({\r\n            top: this.formatStyle(box.top, 'px'),\r\n            bottom: this.formatStyle(box.bottom, 'px'),\r\n            paddingLeft: this.formatStyle(box.left, 'px'),\r\n            paddingRight: this.formatStyle(box.right, 'px'),\r\n            height: 'auto',\r\n            width: this.formatStyle(box.width, 'px')\r\n        });\r\n    };\r\n}\r\n\r\nCueStyleBox.prototype = Object.create(StyleBox.prototype);\r\nCueStyleBox.prototype.constructor = CueStyleBox;\r\n\r\n// Represents the co-ordinates of an Element in a way that we can easily\r\n// compute things with such as if it overlaps or intersects with another Element.\r\n// Can initialize it with either a StyleBox or another BoxPosition.\r\nfunction BoxPosition(obj) {\r\n    // Either a BoxPosition was passed in and we need to copy it, or a StyleBox\r\n    // was passed in and we need to copy the results of 'getBoundingClientRect'\r\n    // as the object returned is readonly. All co-ordinate values are in reference\r\n    // to the viewport origin (top left).\r\n    var lh;\r\n    if (obj.div) {\r\n        var height = obj.div.offsetHeight;\r\n        var width = obj.div.offsetWidth;\r\n        var top = obj.div.offsetTop;\r\n\r\n        var rects = (rects = obj.div.childNodes) && (rects = rects[0]) &&\r\n            rects.getClientRects && rects.getClientRects();\r\n        obj = obj.div.getBoundingClientRect();\r\n        // In certain cases the outter div will be slightly larger then the sum of\r\n        // the inner div's lines. This could be due to bold text, etc, on some platforms.\r\n        // In this case we should get the average line height and use that. This will\r\n        // result in the desired behaviour.\r\n        lh = rects ? Math.max((rects[0] && rects[0].height) || 0, obj.height / rects.length)\r\n            : 0;\r\n\r\n    }\r\n    this.left = obj.left;\r\n    this.right = obj.right;\r\n    this.top = obj.top || top;\r\n    this.height = obj.height || height;\r\n    this.bottom = obj.bottom || (top + (obj.height || height));\r\n    this.width = obj.width || width;\r\n    this.lineHeight = lh !== undefined ? lh : obj.lineHeight;\r\n\r\n    // Sets the width to be slightly larger to prevent text wrapping in IE 11\r\n    this.width = Math.ceil(this.width + 1);\r\n}\r\n\r\n// Move the box along a particular axis. Optionally pass in an amount to move\r\n// the box. If no amount is passed then the default is the line height of the\r\n// box.\r\nBoxPosition.prototype.move = function (axis, toMove) {\r\n    toMove = toMove !== undefined ? toMove : this.lineHeight;\r\n    switch (axis) {\r\n        case '+x':\r\n            this.left += toMove;\r\n            this.right += toMove;\r\n            break;\r\n        case '-x':\r\n            this.left -= toMove;\r\n            this.right -= toMove;\r\n            break;\r\n        case '+y':\r\n            this.top += toMove;\r\n            this.bottom += toMove;\r\n            break;\r\n        case '-y':\r\n            this.top -= toMove;\r\n            this.bottom -= toMove;\r\n            break;\r\n        default:\r\n            break;\r\n    }\r\n};\r\n\r\n// Check if this box overlaps another box, b2.\r\nBoxPosition.prototype.overlaps = function (b2) {\r\n    return this.left < b2.right &&\r\n        this.right > b2.left &&\r\n        this.top < b2.bottom &&\r\n        this.bottom > b2.top;\r\n};\r\n\r\n// Check if this box overlaps any other boxes in boxes.\r\nBoxPosition.prototype.overlapsAny = function (boxes) {\r\n    for (var i = 0; i < boxes.length; i++) {\r\n        if (this.overlaps(boxes[i])) {\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n};\r\n\r\n// Check if this box is within another box.\r\nBoxPosition.prototype.within = function (container) {\r\n    return this.top >= container.top &&\r\n        this.bottom <= container.bottom &&\r\n        this.left >= container.left &&\r\n        this.right <= container.right;\r\n};\r\n\r\n// Check if this box is entirely within the container or it is overlapping\r\n// on the edge opposite of the axis direction passed. For example, if \"+x\" is\r\n// passed and the box is overlapping on the left edge of the container, then\r\n// return true.\r\nBoxPosition.prototype.overlapsOppositeAxis = function (container, axis) {\r\n    switch (axis) {\r\n        case '+x':\r\n            return this.left < container.left;\r\n        case '-x':\r\n            return this.right > container.right;\r\n        case '+y':\r\n            return this.top < container.top;\r\n        case '-y':\r\n            return this.bottom > container.bottom;\r\n        default:\r\n            break;\r\n    }\r\n};\r\n\r\n// Find the percentage of the area that this box is overlapping with another\r\n// box.\r\nBoxPosition.prototype.intersectPercentage = function (b2) {\r\n    var x = Math.max(0, Math.min(this.right, b2.right) - Math.max(this.left, b2.left));\r\n    var y = Math.max(0, Math.min(this.bottom, b2.bottom) - Math.max(this.top, b2.top));\r\n    var intersectArea = x * y;\r\n    return intersectArea / (this.height * this.width);\r\n};\r\n\r\n// Convert the positions from this box to CSS compatible positions using\r\n// the reference container's positions. This has to be done because this\r\n// box's positions are in reference to the viewport origin, whereas, CSS\r\n// values are in reference to their respective edges.\r\nBoxPosition.prototype.toCSSCompatValues = function (reference) {\r\n    return {\r\n        top: this.top - reference.top,\r\n        bottom: reference.bottom - this.bottom,\r\n        paddingLeft: this.left - reference.left,\r\n        paddingRight: reference.right - this.right,\r\n        height: this.height,\r\n        width: this.width\r\n    };\r\n};\r\n\r\n// Get an object that represents the box's position without anything extra.\r\n// Can pass a StyleBox, HTMLElement, or another BoxPositon.\r\nBoxPosition.getSimpleBoxPosition = function (obj) {\r\n    var height = obj.div ? obj.div.offsetHeight : obj.tagName ? obj.offsetHeight : 0;\r\n    var width = obj.div ? obj.div.offsetWidth : obj.tagName ? obj.offsetWidth : 0;\r\n    var top = obj.div ? obj.div.offsetTop : obj.tagName ? obj.offsetTop : 0;\r\n\r\n    obj = obj.div ? obj.div.getBoundingClientRect() :\r\n        obj.tagName ? obj.getBoundingClientRect() : obj;\r\n    var ret = {\r\n        left: obj.left,\r\n        right: obj.right,\r\n        top: obj.top || top,\r\n        height: obj.height || height,\r\n        bottom: obj.bottom || (top + (obj.height || height)),\r\n        width: obj.width || width\r\n    };\r\n    return ret;\r\n};\r\n\r\n// Move a StyleBox to its specified, or next best, position. The containerBox\r\n// is the box that contains the StyleBox, such as a div. boxPositions are\r\n// a list of other boxes that the styleBox can't overlap with.\r\n// @param numLinesOfText added on 08/03/16 by Evol Greaves evol@jwplayer.com.\r\n// Puts the cue in the \"best fit\" line if the cue's line would cause text to fall outside the containerBox\r\nfunction moveBoxToLinePosition(window, styleBox, containerBox, boxPositions, numLinesOfText) {\r\n\r\n    // Find the best position for a cue box, b, on the video. The axis parameter\r\n    // is a list of axis, the order of which, it will move the box along. For example:\r\n    // Passing [\"+x\", \"-x\"] will move the box first along the x axis in the positive\r\n    // direction. If it doesn't find a good position for it there it will then move\r\n    // it along the x axis in the negative direction.\r\n    function findBestPosition(b, axis) {\r\n        var bestPosition;\r\n        var specifiedPosition = new BoxPosition(b);\r\n        var percentage = 1; // Highest possible so the first thing we get is better.\r\n\r\n        for (var i = 0; i < axis.length; i++) {\r\n            while (b.overlapsOppositeAxis(containerBox, axis[i]) ||\r\n            (b.within(containerBox) && b.overlapsAny(boxPositions))) {\r\n                b.move(axis[i]);\r\n            }\r\n            // We found a spot where we aren't overlapping anything. This is our\r\n            // best position.\r\n            if (b.within(containerBox)) {\r\n                return b;\r\n            }\r\n            var p = b.intersectPercentage(containerBox);\r\n            // If we're outside the container box less then we were on our last try\r\n            // then remember this position as the best position.\r\n            if (percentage > p) {\r\n                bestPosition = new BoxPosition(b);\r\n                percentage = p;\r\n            }\r\n            // Reset the box position to the specified position.\r\n            b = new BoxPosition(specifiedPosition);\r\n        }\r\n        return bestPosition || specifiedPosition;\r\n    }\r\n\r\n    var boxPosition = new BoxPosition(styleBox);\r\n    var cue = styleBox.cue;\r\n    var linePos = computeLinePos(cue);\r\n    var axis = [];\r\n\r\n    // If we have a line number to align the cue to.\r\n    if (cue.snapToLines) {\r\n        var size;\r\n        switch (cue.vertical) {\r\n            case '':\r\n                axis = ['+y', '-y'];\r\n                size = 'height';\r\n                break;\r\n            case 'rl':\r\n                axis = ['+x', '-x'];\r\n                size = 'width';\r\n                break;\r\n            case 'lr':\r\n                axis = ['-x', '+x'];\r\n                size = 'width';\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n\r\n        var step = boxPosition.lineHeight;\r\n        // maxLines added on 8/03/2016 by Evol Greaves: evol@jwplayer.com.\r\n        // This ensures that cues are positioned according to the maximum number of lines\r\n        // that can be displayed based on the container size.\r\n        // The position also needs to account for the number of lines of text to ensure\r\n        // text isn't cut off at the bottom of the container\r\n        var maxLines = Math.floor(containerBox[size] / step);\r\n        linePos = Math.min(linePos, maxLines - numLinesOfText);\r\n        var position = step * Math.round(linePos);\r\n        var maxPosition = containerBox[size] + step;\r\n        var initialAxis = axis[0];\r\n\r\n        // If the specified initial position is greater than the max position, then\r\n        // clamp the box to the amount of steps it would take for the box to\r\n        // reach the max position.\r\n        if (Math.abs(position) > maxPosition) {\r\n            position = position < 0 ? -1 : 1;\r\n            position *= Math.ceil(maxPosition / step) * step;\r\n        }\r\n\r\n        // If computed line position returns negative then line numbers are\r\n        // relative to the bottom of the video instead of the top. Therefore, we\r\n        // need to increase our initial position by the length or width of the\r\n        // video, depending on the writing direction, and reverse our axis directions.\r\n        if (linePos < 0) {\r\n            position += cue.vertical === '' ? containerBox.height : containerBox.width;\r\n            // textHeight added on 8/04/2016 by Evol Greaves: evol@jwplayer.com\r\n            // Account for lines of text when determining position based on a negative line value\r\n            var textHeight = numLinesOfText * step;\r\n            position -= textHeight;\r\n            axis = axis.reverse();\r\n        }\r\n\r\n        // Shift the position of the captions up to prevent minor overlaps as the text is laid out in IE11\r\n        position -= numLinesOfText;\r\n\r\n        // Move the box to the specified position. This may not be its best\r\n        // position.\r\n        boxPosition.move(initialAxis, position);\r\n    } else {\r\n        // If we have a percentage line value for the cue.\r\n        var calculatedPercentage = (boxPosition.lineHeight / containerBox.height) * 100;\r\n\r\n        switch (cue.lineAlign) {\r\n            case 'middle':\r\n                linePos -= (calculatedPercentage / 2);\r\n                break;\r\n            case 'end':\r\n                linePos -= calculatedPercentage;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n\r\n        // Apply initial line position to the cue box.\r\n        switch (cue.vertical) {\r\n            case '':\r\n                styleBox.applyStyles({\r\n                    top: styleBox.formatStyle(linePos, '%')\r\n                });\r\n                break;\r\n            case 'rl':\r\n                styleBox.applyStyles({\r\n                    paddingLeft: styleBox.formatStyle(linePos, '%')\r\n                });\r\n                break;\r\n            case 'lr':\r\n                styleBox.applyStyles({\r\n                    paddingRight: styleBox.formatStyle(linePos, '%')\r\n                });\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n\r\n        axis = ['+y', '-x', '+x', '-y'];\r\n\r\n        // Get the box position again after we've applied the specified positioning\r\n        // to it.\r\n        boxPosition = new BoxPosition(styleBox);\r\n    }\r\n\r\n    var bestPosition = findBestPosition(boxPosition, axis);\r\n    styleBox.move(bestPosition.toCSSCompatValues(containerBox));\r\n}\r\n\r\nfunction WebVTT() {\r\n    // Nothing\r\n}\r\n\r\n// Helper to allow strings to be decoded instead of the default binary utf8 data.\r\nWebVTT.StringDecoder = function () {\r\n    return {\r\n        decode: function (data) {\r\n            if (!data) {\r\n                return '';\r\n            }\r\n            if (typeof data !== 'string') {\r\n                throw new Error('Error - expected string data.');\r\n            }\r\n            return decodeURIComponent(encodeURIComponent(data));\r\n        }\r\n    };\r\n};\r\n\r\nWebVTT.convertCueToDOMTree = function (window, cuetext) {\r\n    if (!window || !cuetext) {\r\n        return null;\r\n    }\r\n    return parseContent(window, cuetext);\r\n};\r\n\r\nvar CUE_BACKGROUND_PADDING = '1.5%';\r\n\r\n\r\n// Determine if we need to compute the display states of the cues. This could\r\n// be the case if a cue's state has been changed since the last computation or\r\n// if it has not been computed yet.\r\nfunction shouldCompute(cues) {\r\n    for (var i = 0; i < cues.length; i++) {\r\n        if (cues[i].hasBeenReset || !cues[i].displayState) {\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\n// Runs the processing model over the cues and regions passed to it.\r\n// @param overlay A block level element (usually a div) that the computed cues\r\n//                and regions will be placed into.\r\n// @param updateBoxPosition added on 6/29/2016 by Evol Greaves: evol@jwplayer.com.\r\n// This ensures that cues are displayed within the overlay whenever its size changes\r\nWebVTT.processCues = function (window, cues, overlay, updateBoxPosition) {\r\n    if (!window || !cues || !overlay) {\r\n        return null;\r\n    }\r\n\r\n    // Remove all previous children.\r\n    while (overlay.firstChild) {\r\n        overlay.removeChild(overlay.firstChild);\r\n    }\r\n\r\n    // Return early if there are no cues to process\r\n    if (!cues.length) {\r\n        return null;\r\n    }\r\n\r\n    var paddedOverlay = window.document.createElement('div');\r\n    // Added on 6/21/2016 by Evol Greaves: evol@jwplayer.com for styling captions with CSS\r\n    paddedOverlay.className = 'jw-text-track-container jw-reset';\r\n    paddedOverlay.style.position = 'absolute';\r\n    paddedOverlay.style.left = '0';\r\n    paddedOverlay.style.right = '0';\r\n    paddedOverlay.style.top = '0';\r\n    paddedOverlay.style.bottom = '0';\r\n    paddedOverlay.style.margin = CUE_BACKGROUND_PADDING;\r\n    overlay.appendChild(paddedOverlay);\r\n\r\n    // We don't need to recompute the cues' display states. Just reuse them.\r\n    if (!shouldCompute(cues) && !updateBoxPosition) {\r\n        for (var i = 0; i < cues.length; i++) {\r\n            paddedOverlay.appendChild(cues[i].displayState);\r\n        }\r\n        return;\r\n    }\r\n\r\n    var boxPositions = [];\r\n    var containerBox = BoxPosition.getSimpleBoxPosition(paddedOverlay);\r\n    var currentNumOfLines = cues.reduce(function(totalLines, cue) {\r\n        return totalLines + cue.text.split('\\n').length;\r\n    }, 0);\r\n\r\n    (function () {\r\n        for (var j = 0; j < cues.length; j++) {\r\n            var cue = cues[j];\r\n\r\n            // Compute the initial position and styles of the cue div.\r\n            var styleBox = new CueStyleBox(window, cue);\r\n            // Added on 6/21/2016 by Evol Greaves: evol@jwplayer.com for styling captions with CSS\r\n            styleBox.div.className = 'jw-text-track-display jw-reset';\r\n            paddedOverlay.appendChild(styleBox.div);\r\n\r\n            // Move the cue div to it's correct line position.\r\n            // Added on 08/03/2016 by Evol Greaves: evol@jwplayer.com for determining the correct\r\n            // position to place the containerBox.\r\n            moveBoxToLinePosition(window, styleBox, containerBox, boxPositions, currentNumOfLines);\r\n            currentNumOfLines -= cue.text.split('\\n').length;\r\n\r\n            // Remember the computed div so that we don't have to recompute it later\r\n            // if we don't have too.\r\n            cue.displayState = styleBox.div;\r\n\r\n            boxPositions.push(BoxPosition.getSimpleBoxPosition(styleBox));\r\n        }\r\n    }());\r\n};\r\n\r\nlet webVttExport = window.WebVTT;\r\nif (!webVttExport) {\r\n    window.WebVTT = webVttExport = WebVTT;\r\n}\r\n\r\nexport default webVttExport;\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/polyfills/webvtt.js"],"sourceRoot":""}