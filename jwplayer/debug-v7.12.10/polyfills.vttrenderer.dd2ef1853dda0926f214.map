{"version":3,"sources":["webpack:///./src/js/polyfills/vtt.js"],"names":["ParsingError","errorData","message","name","code","prototype","Object","create","Error","constructor","Errors","BadSignature","BadTimeStamp","parseTimeStamp","input","computeSeconds","h","m","s","f","match","replace","Settings","values","set","k","v","get","dflt","defaultKey","has","alt","a","n","length","integer","test","parseInt","percent","parseFloat","ESCAPE","TAG_NAME","c","i","b","u","ruby","rt","lang","TAG_ANNOTATION","NEEDS_PARENT","parseContent","window","nextToken","consume","result","substr","unescape1","e","unescape","shouldAdd","current","element","localName","createElement","type","annotation","tagName","document","trim","rootDiv","t","tagStack","pop","parentNode","ts","node","createProcessingInstruction","appendChild","className","push","createTextNode","strongRTLRanges","isStrongRTLChar","charCode","currentRange","pushNodes","nodeStack","childNodes","nextTextNode","text","textContent","innerText","determineBidi","cueDiv","charCodeAt","computeLinePos","cue","line","snapToLines","track","textTrackList","mediaElement","trackList","count","mode","StyleBox","applyStyles","styles","div","prop","hasOwnProperty","style","formatStyle","val","unit","CueStyleBox","call","textShadow","position","left","right","top","bottom","display","writingMode","vertical","unicodeBidi","textAlign","align","whiteSpace","direction","textPos","size","Math","max","min","width","height","move","box","BoxPosition","obj","lh","offsetHeight","offsetWidth","offsetTop","rects","getClientRects","getBoundingClientRect","lineHeight","undefined","ceil","axis","toMove","overlaps","b2","overlapsAny","boxes","within","container","overlapsOppositeAxis","intersectPercentage","x","y","intersectArea","toCSSCompatValues","reference","getSimpleBoxPosition","ret","moveBoxToLinePosition","styleBox","containerBox","boxPositions","numLinesOfText","findBestPosition","bestPosition","specifiedPosition","percentage","p","boxPosition","linePos","step","maxLines","floor","round","maxPosition","initialAxis","abs","textHeight","reverse","calculatedPercentage","lineAlign","WebVTT","StringDecoder","decode","data","decodeURIComponent","encodeURIComponent","convertCueToDOMTree","cuetext","CUE_BACKGROUND_PADDING","shouldCompute","cues","hasBeenReset","displayState","processCues","overlay","updateBoxPosition","firstChild","removeChild","paddedOverlay","margin","currentNumOfLines","reduce","totalLines","split","j"],"mappings":"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","file":"polyfills.vttrenderer.js","sourcesContent":["/**\r\n * Copyright 2013 vtt.js Contributors\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\n/* eslint no-unused-expressions: 0, no-nested-ternary: 0 */\r\n\r\ndefine([\r\n\r\n], function () {\r\n\r\n    // Creates a new ParserError object from an errorData object. The errorData\r\n    // object should have default code and message properties. The default message\r\n    // property can be overriden by passing in a message parameter.\r\n    // See ParsingError.Errors below for acceptable errors.\r\n    function ParsingError(errorData, message) {\r\n        this.name = 'ParsingError';\r\n        this.code = errorData.code;\r\n        this.message = message || errorData.message;\r\n    }\r\n\r\n    ParsingError.prototype = Object.create(Error.prototype);\r\n    ParsingError.prototype.constructor = ParsingError;\r\n\r\n    // ParsingError metadata for acceptable ParsingErrors.\r\n    ParsingError.Errors = {\r\n        BadSignature: {\r\n            code: 0,\r\n            message: 'Malformed WebVTT signature.'\r\n        },\r\n        BadTimeStamp: {\r\n            code: 1,\r\n            message: 'Malformed time stamp.'\r\n        }\r\n    };\r\n\r\n    // Try to parse input as a time stamp.\r\n    function parseTimeStamp(input) {\r\n\r\n        function computeSeconds(h, m, s, f) {\r\n            return (h | 0) * 3600 + (m | 0) * 60 + (s | 0) + (f | 0) / 1000;\r\n        }\r\n\r\n        var m = input.match(/^(\\d+):(\\d{2})(:\\d{2})?\\.(\\d{3})/);\r\n        if (!m) {\r\n            return null;\r\n        }\r\n\r\n        if (m[3]) {\r\n            // Timestamp takes the form of [hours]:[minutes]:[seconds].[milliseconds]\r\n            return computeSeconds(m[1], m[2], m[3].replace(':', ''), m[4]);\r\n        } else if (m[1] > 59) {\r\n            // Timestamp takes the form of [hours]:[minutes].[milliseconds]\r\n            // First position is hours as it's over 59.\r\n            return computeSeconds(m[1], m[2], 0, m[4]);\r\n        }\r\n        // Timestamp takes the form of [minutes]:[seconds].[milliseconds]\r\n        return computeSeconds(0, m[1], m[2], m[4]);\r\n    }\r\n\r\n    // A settings object holds key/value pairs and will ignore anything but the first\r\n    // assignment to a specific key.\r\n    function Settings() {\r\n        this.values = Object.create(null);\r\n    }\r\n\r\n    Settings.prototype = {\r\n        // Only accept the first assignment to any key.\r\n        set: function (k, v) {\r\n            if (!this.get(k) && v !== '') {\r\n                this.values[k] = v;\r\n            }\r\n        },\r\n        // Return the value for a key, or a default value.\r\n        // If 'defaultKey' is passed then 'dflt' is assumed to be an object with\r\n        // a number of possible default values as properties where 'defaultKey' is\r\n        // the key of the property that will be chosen; otherwise it's assumed to be\r\n        // a single value.\r\n        get: function (k, dflt, defaultKey) {\r\n            if (defaultKey) {\r\n                return this.has(k) ? this.values[k] : dflt[defaultKey];\r\n            }\r\n            return this.has(k) ? this.values[k] : dflt;\r\n        },\r\n        // Check whether we have a value for a key.\r\n        has: function (k) {\r\n            return k in this.values;\r\n        },\r\n        // Accept a setting if its one of the given alternatives.\r\n        alt: function (k, v, a) {\r\n            for (var n = 0; n < a.length; ++n) {\r\n                if (v === a[n]) {\r\n                    this.set(k, v);\r\n                    break;\r\n                }\r\n            }\r\n        },\r\n        // Accept a setting if its a valid (signed) integer.\r\n        integer: function (k, v) {\r\n            if (/^-?\\d+$/.test(v)) { // integer\r\n                this.set(k, parseInt(v, 10));\r\n            }\r\n        },\r\n        // Accept a setting if its a valid percentage.\r\n        percent: function (k, v) {\r\n            if ((/^[\\d]{1,3}(\\.[\\d]*)?%$/).test(v)) {\r\n                v = parseFloat(v);\r\n                if (v >= 0 && v <= 100) {\r\n                    this.set(k, v);\r\n                    return true;\r\n                }\r\n            }\r\n            return false;\r\n        }\r\n    };\r\n\r\n    var ESCAPE = {\r\n        '&amp;': '&',\r\n        '&lt;': '<',\r\n        '&gt;': '>',\r\n        '&lrm;': '\\u200e',\r\n        '&rlm;': '\\u200f',\r\n        '&nbsp;': '\\u00a0'\r\n    };\r\n\r\n    var TAG_NAME = {\r\n        c: 'span',\r\n        i: 'i',\r\n        b: 'b',\r\n        u: 'u',\r\n        ruby: 'ruby',\r\n        rt: 'rt',\r\n        v: 'span',\r\n        lang: 'span'\r\n    };\r\n\r\n    var TAG_ANNOTATION = {\r\n        v: 'title',\r\n        lang: 'lang'\r\n    };\r\n\r\n    var NEEDS_PARENT = {\r\n        rt: 'ruby'\r\n    };\r\n\r\n    // Parse content into a document fragment.\r\n    function parseContent(window, input) {\r\n        function nextToken() {\r\n            // Check for end-of-string.\r\n            if (!input) {\r\n                return null;\r\n            }\r\n\r\n            // Consume 'n' characters from the input.\r\n            function consume(result) {\r\n                input = input.substr(result.length);\r\n                return result;\r\n            }\r\n\r\n            var m = input.match(/^([^<]*)(<[^>]+>?)?/);\r\n            // If there is some text before the next tag, return it, otherwise return\r\n            // the tag.\r\n            return consume(m[1] ? m[1] : m[2]);\r\n        }\r\n\r\n        // Unescape a string 's'.\r\n        function unescape1(e) {\r\n            return ESCAPE[e];\r\n        }\r\n\r\n        function unescape(s) {\r\n            while ((m = s.match(/&(amp|lt|gt|lrm|rlm|nbsp);/))) {\r\n                s = s.replace(m[0], unescape1);\r\n            }\r\n            return s;\r\n        }\r\n\r\n        function shouldAdd(current, element) {\r\n            return !NEEDS_PARENT[element.localName] ||\r\n                NEEDS_PARENT[element.localName] === current.localName;\r\n        }\r\n\r\n        // Create an element for this tag.\r\n        function createElement(type, annotation) {\r\n            var tagName = TAG_NAME[type];\r\n            if (!tagName) {\r\n                return null;\r\n            }\r\n            var element = window.document.createElement(tagName);\r\n            element.localName = tagName;\r\n            var name = TAG_ANNOTATION[type];\r\n            if (name && annotation) {\r\n                element[name] = annotation.trim();\r\n            }\r\n            return element;\r\n        }\r\n\r\n        var rootDiv = window.document.createElement('div');\r\n        var current = rootDiv;\r\n        var t;\r\n        var tagStack = [];\r\n\r\n        while ((t = nextToken()) !== null) {\r\n            if (t[0] === '<') {\r\n                if (t[1] === '/') {\r\n                    // If the closing tag matches, move back up to the parent node.\r\n                    if (tagStack.length &&\r\n                        tagStack[tagStack.length - 1] === t.substr(2).replace('>', '')) {\r\n                        tagStack.pop();\r\n                        current = current.parentNode;\r\n                    }\r\n                    // Otherwise just ignore the end tag.\r\n                    continue;\r\n                }\r\n                var ts = parseTimeStamp(t.substr(1, t.length - 2));\r\n                var node;\r\n                if (ts) {\r\n                    // Timestamps are lead nodes as well.\r\n                    node = window.document.createProcessingInstruction('timestamp', ts);\r\n                    current.appendChild(node);\r\n                    continue;\r\n                }\r\n                var m = t.match(/^<([^.\\s/0-9>]+)(\\.[^\\s\\\\>]+)?([^>\\\\]+)?(\\\\?)>?$/);\r\n                // If we can't parse the tag, skip to the next tag.\r\n                if (!m) {\r\n                    continue;\r\n                }\r\n                // Try to construct an element, and ignore the tag if we couldn't.\r\n                node = createElement(m[1], m[3]);\r\n                if (!node) {\r\n                    continue;\r\n                }\r\n                // Determine if the tag should be added based on the context of where it\r\n                // is placed in the cuetext.\r\n                if (!shouldAdd(current, node)) {\r\n                    continue;\r\n                }\r\n                // Set the class list (as a list of classes, separated by space).\r\n                if (m[2]) {\r\n                    node.className = m[2].substr(1).replace('.', ' ');\r\n                }\r\n                // Append the node to the current node, and enter the scope of the new\r\n                // node.\r\n                tagStack.push(m[1]);\r\n                current.appendChild(node);\r\n                current = node;\r\n                continue;\r\n            }\r\n\r\n            // Text nodes are leaf nodes.\r\n            current.appendChild(window.document.createTextNode(unescape(t)));\r\n        }\r\n\r\n        return rootDiv;\r\n    }\r\n\r\n    // This is a list of all the Unicode characters that have a strong\r\n    // right-to-left category. What this means is that these characters are\r\n    // written right-to-left for sure. It was generated by pulling all the strong\r\n    // right-to-left characters out of the Unicode data table. That table can\r\n    // found at: http://www.unicode.org/Public/UNIDATA/UnicodeData.txt\r\n    var strongRTLRanges = [[0x5be, 0x5be], [0x5c0, 0x5c0], [0x5c3, 0x5c3], [0x5c6, 0x5c6],\r\n        [0x5d0, 0x5ea], [0x5f0, 0x5f4], [0x608, 0x608], [0x60b, 0x60b], [0x60d, 0x60d],\r\n        [0x61b, 0x61b], [0x61e, 0x64a], [0x66d, 0x66f], [0x671, 0x6d5], [0x6e5, 0x6e6],\r\n        [0x6ee, 0x6ef], [0x6fa, 0x70d], [0x70f, 0x710], [0x712, 0x72f], [0x74d, 0x7a5],\r\n        [0x7b1, 0x7b1], [0x7c0, 0x7ea], [0x7f4, 0x7f5], [0x7fa, 0x7fa], [0x800, 0x815],\r\n        [0x81a, 0x81a], [0x824, 0x824], [0x828, 0x828], [0x830, 0x83e], [0x840, 0x858],\r\n        [0x85e, 0x85e], [0x8a0, 0x8a0], [0x8a2, 0x8ac], [0x200f, 0x200f],\r\n        [0xfb1d, 0xfb1d], [0xfb1f, 0xfb28], [0xfb2a, 0xfb36], [0xfb38, 0xfb3c],\r\n        [0xfb3e, 0xfb3e], [0xfb40, 0xfb41], [0xfb43, 0xfb44], [0xfb46, 0xfbc1],\r\n        [0xfbd3, 0xfd3d], [0xfd50, 0xfd8f], [0xfd92, 0xfdc7], [0xfdf0, 0xfdfc],\r\n        [0xfe70, 0xfe74], [0xfe76, 0xfefc], [0x10800, 0x10805], [0x10808, 0x10808],\r\n        [0x1080a, 0x10835], [0x10837, 0x10838], [0x1083c, 0x1083c], [0x1083f, 0x10855],\r\n        [0x10857, 0x1085f], [0x10900, 0x1091b], [0x10920, 0x10939], [0x1093f, 0x1093f],\r\n        [0x10980, 0x109b7], [0x109be, 0x109bf], [0x10a00, 0x10a00], [0x10a10, 0x10a13],\r\n        [0x10a15, 0x10a17], [0x10a19, 0x10a33], [0x10a40, 0x10a47], [0x10a50, 0x10a58],\r\n        [0x10a60, 0x10a7f], [0x10b00, 0x10b35], [0x10b40, 0x10b55], [0x10b58, 0x10b72],\r\n        [0x10b78, 0x10b7f], [0x10c00, 0x10c48], [0x1ee00, 0x1ee03], [0x1ee05, 0x1ee1f],\r\n        [0x1ee21, 0x1ee22], [0x1ee24, 0x1ee24], [0x1ee27, 0x1ee27], [0x1ee29, 0x1ee32],\r\n        [0x1ee34, 0x1ee37], [0x1ee39, 0x1ee39], [0x1ee3b, 0x1ee3b], [0x1ee42, 0x1ee42],\r\n        [0x1ee47, 0x1ee47], [0x1ee49, 0x1ee49], [0x1ee4b, 0x1ee4b], [0x1ee4d, 0x1ee4f],\r\n        [0x1ee51, 0x1ee52], [0x1ee54, 0x1ee54], [0x1ee57, 0x1ee57], [0x1ee59, 0x1ee59],\r\n        [0x1ee5b, 0x1ee5b], [0x1ee5d, 0x1ee5d], [0x1ee5f, 0x1ee5f], [0x1ee61, 0x1ee62],\r\n        [0x1ee64, 0x1ee64], [0x1ee67, 0x1ee6a], [0x1ee6c, 0x1ee72], [0x1ee74, 0x1ee77],\r\n        [0x1ee79, 0x1ee7c], [0x1ee7e, 0x1ee7e], [0x1ee80, 0x1ee89], [0x1ee8b, 0x1ee9b],\r\n        [0x1eea1, 0x1eea3], [0x1eea5, 0x1eea9], [0x1eeab, 0x1eebb], [0x10fffd, 0x10fffd]];\r\n\r\n    function isStrongRTLChar(charCode) {\r\n        for (var i = 0; i < strongRTLRanges.length; i++) {\r\n            var currentRange = strongRTLRanges[i];\r\n            if (charCode >= currentRange[0] && charCode <= currentRange[1]) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    function pushNodes(nodeStack, node) {\r\n        for (var i = node.childNodes.length - 1; i >= 0; i--) {\r\n            nodeStack.push(node.childNodes[i]);\r\n        }\r\n    }\r\n\r\n    function nextTextNode(nodeStack) {\r\n        if (!nodeStack || !nodeStack.length) {\r\n            return null;\r\n        }\r\n\r\n        var node = nodeStack.pop();\r\n        var text = node.textContent || node.innerText;\r\n        if (text) {\r\n            // TODO: This should match all unicode type B characters (paragraph\r\n            // separator characters). See issue #115.\r\n            var m = text.match(/^.*(\\n|\\r)/);\r\n            if (m) {\r\n                nodeStack.length = 0;\r\n                return m[0];\r\n            }\r\n            return text;\r\n        }\r\n        if (node.tagName === 'ruby') {\r\n            return nextTextNode(nodeStack);\r\n        }\r\n        if (node.childNodes) {\r\n            pushNodes(nodeStack, node);\r\n            return nextTextNode(nodeStack);\r\n        }\r\n    }\r\n\r\n    function determineBidi(cueDiv) {\r\n        if (!cueDiv || !cueDiv.childNodes) {\r\n            return 'ltr';\r\n        }\r\n\r\n        var nodeStack = [];\r\n        var text;\r\n        var charCode;\r\n\r\n        pushNodes(nodeStack, cueDiv);\r\n        while ((text = nextTextNode(nodeStack))) {\r\n            for (var i = 0; i < text.length; i++) {\r\n                charCode = text.charCodeAt(i);\r\n                if (isStrongRTLChar(charCode)) {\r\n                    return 'rtl';\r\n                }\r\n            }\r\n        }\r\n        return 'ltr';\r\n    }\r\n\r\n    function computeLinePos(cue) {\r\n        if (typeof cue.line === 'number' &&\r\n            (cue.snapToLines || (cue.line >= 0 && cue.line <= 100))) {\r\n            return cue.line;\r\n        }\r\n        if (!cue.track || !cue.track.textTrackList || !cue.track.textTrackList.mediaElement) {\r\n            return -1;\r\n        }\r\n        var track = cue.track;\r\n        var trackList = track.textTrackList;\r\n        var count = 0;\r\n        for (var i = 0; i < trackList.length && trackList[i] !== track; i++) {\r\n            if (trackList[i].mode === 'showing') {\r\n                count++;\r\n            }\r\n        }\r\n        return ++count * -1;\r\n    }\r\n\r\n    function StyleBox() {\r\n    }\r\n\r\n    // Apply styles to a div. If there is no div passed then it defaults to the\r\n    // div on 'this'.\r\n    StyleBox.prototype.applyStyles = function (styles, div) {\r\n        div = div || this.div;\r\n        for (var prop in styles) {\r\n            if (styles.hasOwnProperty(prop)) {\r\n                div.style[prop] = styles[prop];\r\n            }\r\n        }\r\n    };\r\n\r\n    StyleBox.prototype.formatStyle = function (val, unit) {\r\n        return val === 0 ? 0 : val + unit;\r\n    };\r\n\r\n    // Constructs the computed display state of the cue (a div). Places the div\r\n    // into the overlay which should be a block level element (usually a div).\r\n    function CueStyleBox(window, cue) {\r\n\r\n        StyleBox.call(this);\r\n        this.cue = cue;\r\n\r\n        // Parse our cue's text into a DOM tree rooted at 'cueDiv'. This div will\r\n        // have inline positioning and will function as the cue background box.\r\n        this.cueDiv = parseContent(window, cue.text);\r\n        // Added on 6/21/2016 by Evol Greaves: evol@jwplayer.com for styling captions with CSS\r\n        this.cueDiv.className = 'jw-text-track-cue jw-reset';\r\n        var styles = {\r\n            textShadow: '',\r\n            position: 'relative',\r\n            left: 0,\r\n            right: 0,\r\n            top: 0,\r\n            bottom: 0,\r\n            display: 'inline',\r\n            writingMode: cue.vertical === '' ? 'horizontal-tb' : cue.vertical === 'lr' ? 'vertical-lr' : 'vertical-rl',\r\n            unicodeBidi: 'plaintext',\r\n        };\r\n\r\n        this.applyStyles(styles, this.cueDiv);\r\n\r\n        // Create an absolutely positioned div that will be used to position the cue\r\n        // div. Note, all WebVTT cue-setting alignments are equivalent to the CSS\r\n        // mirrors of them except \"middle\" which is \"center\" in CSS.\r\n        this.div = window.document.createElement('div');\r\n        styles = {\r\n            textAlign: cue.align === 'middle' ? 'center' : cue.align,\r\n            whiteSpace: 'pre-line',\r\n            position: 'absolute',\r\n            direction: determineBidi(this.cueDiv),\r\n            writingMode: cue.vertical === '' ? 'horizontal-tb' : cue.vertical === 'lr' ? 'vertical-lr' : 'vertical-rl',\r\n            unicodeBidi: 'plaintext',\r\n        };\r\n\r\n        this.applyStyles(styles);\r\n\r\n        this.div.appendChild(this.cueDiv);\r\n\r\n        // Calculate the distance from the reference edge of the viewport to the text\r\n        // position of the cue box. The reference edge will be resolved later when\r\n        // the box orientation styles are applied.\r\n        var textPos = 0;\r\n        // Modified on 10/05/2016 by Evol Greaves: evol@jwplayer.com.\r\n        // The polyfill used cue.positionAlign to determine whether text should be left,\r\n        // center or right aligned. However, this value is read only after a cue has been created in FF though the\r\n        // spec says this value should be settable. See below link:\r\n        // https://w3c.github.io/webvtt/#ref-for-enumdef-positionalignsetting-1\r\n        // The cue.align property is settable and other browsers use it as the offset from which the cue.position\r\n        // value is applied.\r\n        switch (cue.align) {\r\n            case 'start':\r\n            case 'left':\r\n                textPos = cue.position;\r\n                break;\r\n            case 'middle':\r\n            case 'center':\r\n                textPos = cue.position - (cue.size / 2);\r\n                break;\r\n            case 'end':\r\n            case 'right':\r\n                textPos = cue.position - cue.size;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n\r\n        // Added on 8/04/2016 by Evol Greaves: evol@jwplayer.com.\r\n        // Ensures textPos is within the bounds of the cueBox\r\n        textPos = Math.max(Math.min(100, textPos), 0);\r\n\r\n        // Horizontal box orientation; textPos is the distance from the left edge of the\r\n        // area to the left edge of the box and cue.size is the distance extending to\r\n        // the right from there.\r\n        if (cue.vertical === '') {\r\n            this.applyStyles({\r\n                left: this.formatStyle(textPos, '%'),\r\n                width: this.formatStyle(cue.size, '%')\r\n            });\r\n            // Vertical box orientation; textPos is the distance from the top edge of the\r\n            // area to the top edge of the box and cue.size is the height extending\r\n            // downwards from there.\r\n        } else {\r\n            this.applyStyles({\r\n                top: this.formatStyle(textPos, '%'),\r\n                height: this.formatStyle(cue.size, '%')\r\n            });\r\n        }\r\n\r\n        this.move = function (box) {\r\n            this.applyStyles({\r\n                top: this.formatStyle(box.top, 'px'),\r\n                bottom: this.formatStyle(box.bottom, 'px'),\r\n                left: this.formatStyle(box.left, 'px'),\r\n                right: this.formatStyle(box.right, 'px'),\r\n                height: 'auto',\r\n                width: this.formatStyle(box.width, 'px')\r\n            });\r\n        };\r\n    }\r\n\r\n    CueStyleBox.prototype = Object.create(StyleBox.prototype);\r\n    CueStyleBox.prototype.constructor = CueStyleBox;\r\n\r\n    // Represents the co-ordinates of an Element in a way that we can easily\r\n    // compute things with such as if it overlaps or intersects with another Element.\r\n    // Can initialize it with either a StyleBox or another BoxPosition.\r\n    function BoxPosition(obj) {\r\n        // Either a BoxPosition was passed in and we need to copy it, or a StyleBox\r\n        // was passed in and we need to copy the results of 'getBoundingClientRect'\r\n        // as the object returned is readonly. All co-ordinate values are in reference\r\n        // to the viewport origin (top left).\r\n        var lh;\r\n        if (obj.div) {\r\n            var height = obj.div.offsetHeight;\r\n            var width = obj.div.offsetWidth;\r\n            var top = obj.div.offsetTop;\r\n\r\n            var rects = (rects = obj.div.childNodes) && (rects = rects[0]) &&\r\n                rects.getClientRects && rects.getClientRects();\r\n            obj = obj.div.getBoundingClientRect();\r\n            // In certain cases the outter div will be slightly larger then the sum of\r\n            // the inner div's lines. This could be due to bold text, etc, on some platforms.\r\n            // In this case we should get the average line height and use that. This will\r\n            // result in the desired behaviour.\r\n            lh = rects ? Math.max((rects[0] && rects[0].height) || 0, obj.height / rects.length)\r\n                : 0;\r\n\r\n        }\r\n        this.left = obj.left;\r\n        this.right = obj.right;\r\n        this.top = obj.top || top;\r\n        this.height = obj.height || height;\r\n        this.bottom = obj.bottom || (top + (obj.height || height));\r\n        this.width = obj.width || width;\r\n        this.lineHeight = lh !== undefined ? lh : obj.lineHeight;\r\n\r\n        // Sets the width to be slightly larger to prevent text wrapping in IE 11\r\n        this.width = Math.ceil(this.width + 1);\r\n    }\r\n\r\n    // Move the box along a particular axis. Optionally pass in an amount to move\r\n    // the box. If no amount is passed then the default is the line height of the\r\n    // box.\r\n    BoxPosition.prototype.move = function (axis, toMove) {\r\n        toMove = toMove !== undefined ? toMove : this.lineHeight;\r\n        switch (axis) {\r\n            case '+x':\r\n                this.left += toMove;\r\n                this.right += toMove;\r\n                break;\r\n            case '-x':\r\n                this.left -= toMove;\r\n                this.right -= toMove;\r\n                break;\r\n            case '+y':\r\n                this.top += toMove;\r\n                this.bottom += toMove;\r\n                break;\r\n            case '-y':\r\n                this.top -= toMove;\r\n                this.bottom -= toMove;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    };\r\n\r\n    // Check if this box overlaps another box, b2.\r\n    BoxPosition.prototype.overlaps = function (b2) {\r\n        return this.left < b2.right &&\r\n            this.right > b2.left &&\r\n            this.top < b2.bottom &&\r\n            this.bottom > b2.top;\r\n    };\r\n\r\n    // Check if this box overlaps any other boxes in boxes.\r\n    BoxPosition.prototype.overlapsAny = function (boxes) {\r\n        for (var i = 0; i < boxes.length; i++) {\r\n            if (this.overlaps(boxes[i])) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n\r\n    // Check if this box is within another box.\r\n    BoxPosition.prototype.within = function (container) {\r\n        return this.top >= container.top &&\r\n            this.bottom <= container.bottom &&\r\n            this.left >= container.left &&\r\n            this.right <= container.right;\r\n    };\r\n\r\n    // Check if this box is entirely within the container or it is overlapping\r\n    // on the edge opposite of the axis direction passed. For example, if \"+x\" is\r\n    // passed and the box is overlapping on the left edge of the container, then\r\n    // return true.\r\n    BoxPosition.prototype.overlapsOppositeAxis = function (container, axis) {\r\n        switch (axis) {\r\n            case '+x':\r\n                return this.left < container.left;\r\n            case '-x':\r\n                return this.right > container.right;\r\n            case '+y':\r\n                return this.top < container.top;\r\n            case '-y':\r\n                return this.bottom > container.bottom;\r\n            default:\r\n                break;\r\n        }\r\n    };\r\n\r\n    // Find the percentage of the area that this box is overlapping with another\r\n    // box.\r\n    BoxPosition.prototype.intersectPercentage = function (b2) {\r\n        var x = Math.max(0, Math.min(this.right, b2.right) - Math.max(this.left, b2.left));\r\n        var y = Math.max(0, Math.min(this.bottom, b2.bottom) - Math.max(this.top, b2.top));\r\n        var intersectArea = x * y;\r\n        return intersectArea / (this.height * this.width);\r\n    };\r\n\r\n    // Convert the positions from this box to CSS compatible positions using\r\n    // the reference container's positions. This has to be done because this\r\n    // box's positions are in reference to the viewport origin, whereas, CSS\r\n    // values are in reference to their respective edges.\r\n    BoxPosition.prototype.toCSSCompatValues = function (reference) {\r\n        return {\r\n            top: this.top - reference.top,\r\n            bottom: reference.bottom - this.bottom,\r\n            left: this.left - reference.left,\r\n            right: reference.right - this.right,\r\n            height: this.height,\r\n            width: this.width\r\n        };\r\n    };\r\n\r\n    // Get an object that represents the box's position without anything extra.\r\n    // Can pass a StyleBox, HTMLElement, or another BoxPositon.\r\n    BoxPosition.getSimpleBoxPosition = function (obj) {\r\n        var height = obj.div ? obj.div.offsetHeight : obj.tagName ? obj.offsetHeight : 0;\r\n        var width = obj.div ? obj.div.offsetWidth : obj.tagName ? obj.offsetWidth : 0;\r\n        var top = obj.div ? obj.div.offsetTop : obj.tagName ? obj.offsetTop : 0;\r\n\r\n        obj = obj.div ? obj.div.getBoundingClientRect() :\r\n            obj.tagName ? obj.getBoundingClientRect() : obj;\r\n        var ret = {\r\n            left: obj.left,\r\n            right: obj.right,\r\n            top: obj.top || top,\r\n            height: obj.height || height,\r\n            bottom: obj.bottom || (top + (obj.height || height)),\r\n            width: obj.width || width\r\n        };\r\n        return ret;\r\n    };\r\n\r\n    // Move a StyleBox to its specified, or next best, position. The containerBox\r\n    // is the box that contains the StyleBox, such as a div. boxPositions are\r\n    // a list of other boxes that the styleBox can't overlap with.\r\n    // @param numLinesOfText added on 08/03/16 by Evol Greaves evol@jwplayer.com.\r\n    // Puts the cue in the \"best fit\" line if the cue's line would cause text to fall outside the containerBox\r\n    function moveBoxToLinePosition(window, styleBox, containerBox, boxPositions, numLinesOfText) {\r\n\r\n        // Find the best position for a cue box, b, on the video. The axis parameter\r\n        // is a list of axis, the order of which, it will move the box along. For example:\r\n        // Passing [\"+x\", \"-x\"] will move the box first along the x axis in the positive\r\n        // direction. If it doesn't find a good position for it there it will then move\r\n        // it along the x axis in the negative direction.\r\n        function findBestPosition(b, axis) {\r\n            var bestPosition;\r\n            var specifiedPosition = new BoxPosition(b);\r\n            var percentage = 1; // Highest possible so the first thing we get is better.\r\n\r\n            for (var i = 0; i < axis.length; i++) {\r\n                while (b.overlapsOppositeAxis(containerBox, axis[i]) ||\r\n                (b.within(containerBox) && b.overlapsAny(boxPositions))) {\r\n                    b.move(axis[i]);\r\n                }\r\n                // We found a spot where we aren't overlapping anything. This is our\r\n                // best position.\r\n                if (b.within(containerBox)) {\r\n                    return b;\r\n                }\r\n                var p = b.intersectPercentage(containerBox);\r\n                // If we're outside the container box less then we were on our last try\r\n                // then remember this position as the best position.\r\n                if (percentage > p) {\r\n                    bestPosition = new BoxPosition(b);\r\n                    percentage = p;\r\n                }\r\n                // Reset the box position to the specified position.\r\n                b = new BoxPosition(specifiedPosition);\r\n            }\r\n            return bestPosition || specifiedPosition;\r\n        }\r\n\r\n        var boxPosition = new BoxPosition(styleBox);\r\n        var cue = styleBox.cue;\r\n        var linePos = computeLinePos(cue);\r\n        var axis = [];\r\n\r\n        // If we have a line number to align the cue to.\r\n        if (cue.snapToLines) {\r\n            var size;\r\n            switch (cue.vertical) {\r\n                case '':\r\n                    axis = ['+y', '-y'];\r\n                    size = 'height';\r\n                    break;\r\n                case 'rl':\r\n                    axis = ['+x', '-x'];\r\n                    size = 'width';\r\n                    break;\r\n                case 'lr':\r\n                    axis = ['-x', '+x'];\r\n                    size = 'width';\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n\r\n            var step = boxPosition.lineHeight;\r\n                // maxLines added on 8/03/2016 by Evol Greaves: evol@jwplayer.com.\r\n                // This ensures that cues are positioned according to the maximum number of lines\r\n                // that can be displayed based on the container size.\r\n                // The position also needs to account for the number of lines of text to ensure\r\n                // text isn't cut off at the bottom of the container\r\n            var maxLines = Math.floor(containerBox[size] / step);\r\n            linePos = Math.min(linePos, maxLines - numLinesOfText);\r\n            var position = step * Math.round(linePos);\r\n            var maxPosition = containerBox[size] + step;\r\n            var initialAxis = axis[0];\r\n\r\n            // If the specified initial position is greater than the max position, then\r\n            // clamp the box to the amount of steps it would take for the box to\r\n            // reach the max position.\r\n            if (Math.abs(position) > maxPosition) {\r\n                position = position < 0 ? -1 : 1;\r\n                position *= Math.ceil(maxPosition / step) * step;\r\n            }\r\n\r\n            // If computed line position returns negative then line numbers are\r\n            // relative to the bottom of the video instead of the top. Therefore, we\r\n            // need to increase our initial position by the length or width of the\r\n            // video, depending on the writing direction, and reverse our axis directions.\r\n            if (linePos < 0) {\r\n                position += cue.vertical === '' ? containerBox.height : containerBox.width;\r\n                // textHeight added on 8/04/2016 by Evol Greaves: evol@jwplayer.com\r\n                // Account for lines of text when determining position based on a negative line value\r\n                var textHeight = numLinesOfText * step;\r\n                position -= textHeight;\r\n                axis = axis.reverse();\r\n            }\r\n\r\n            // Shift the position of the captions up to prevent minor overlaps as the text is laid out in IE11\r\n            position -= numLinesOfText;\r\n\r\n            // Move the box to the specified position. This may not be its best\r\n            // position.\r\n            boxPosition.move(initialAxis, position);\r\n        } else {\r\n            // If we have a percentage line value for the cue.\r\n            var calculatedPercentage = (boxPosition.lineHeight / containerBox.height) * 100;\r\n\r\n            switch (cue.lineAlign) {\r\n                case 'middle':\r\n                    linePos -= (calculatedPercentage / 2);\r\n                    break;\r\n                case 'end':\r\n                    linePos -= calculatedPercentage;\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n\r\n            // Apply initial line position to the cue box.\r\n            switch (cue.vertical) {\r\n                case '':\r\n                    styleBox.applyStyles({\r\n                        top: styleBox.formatStyle(linePos, '%')\r\n                    });\r\n                    break;\r\n                case 'rl':\r\n                    styleBox.applyStyles({\r\n                        left: styleBox.formatStyle(linePos, '%')\r\n                    });\r\n                    break;\r\n                case 'lr':\r\n                    styleBox.applyStyles({\r\n                        right: styleBox.formatStyle(linePos, '%')\r\n                    });\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n\r\n            axis = ['+y', '-x', '+x', '-y'];\r\n\r\n            // Get the box position again after we've applied the specified positioning\r\n            // to it.\r\n            boxPosition = new BoxPosition(styleBox);\r\n        }\r\n\r\n        var bestPosition = findBestPosition(boxPosition, axis);\r\n        styleBox.move(bestPosition.toCSSCompatValues(containerBox));\r\n    }\r\n\r\n    function WebVTT() {\r\n        // Nothing\r\n    }\r\n\r\n    // Helper to allow strings to be decoded instead of the default binary utf8 data.\r\n    WebVTT.StringDecoder = function () {\r\n        return {\r\n            decode: function (data) {\r\n                if (!data) {\r\n                    return '';\r\n                }\r\n                if (typeof data !== 'string') {\r\n                    throw new Error('Error - expected string data.');\r\n                }\r\n                return decodeURIComponent(encodeURIComponent(data));\r\n            }\r\n        };\r\n    };\r\n\r\n    WebVTT.convertCueToDOMTree = function (window, cuetext) {\r\n        if (!window || !cuetext) {\r\n            return null;\r\n        }\r\n        return parseContent(window, cuetext);\r\n    };\r\n\r\n    var CUE_BACKGROUND_PADDING = '1.5%';\r\n\r\n\r\n    // Determine if we need to compute the display states of the cues. This could\r\n    // be the case if a cue's state has been changed since the last computation or\r\n    // if it has not been computed yet.\r\n    function shouldCompute(cues) {\r\n        for (var i = 0; i < cues.length; i++) {\r\n            if (cues[i].hasBeenReset || !cues[i].displayState) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    // Runs the processing model over the cues and regions passed to it.\r\n    // @param overlay A block level element (usually a div) that the computed cues\r\n    //                and regions will be placed into.\r\n    // @param updateBoxPosition added on 6/29/2016 by Evol Greaves: evol@jwplayer.com.\r\n    // This ensures that cues are displayed within the overlay whenever its size changes\r\n    WebVTT.processCues = function (window, cues, overlay, updateBoxPosition) {\r\n        if (!window || !cues || !overlay) {\r\n            return null;\r\n        }\r\n\r\n        // Remove all previous children.\r\n        while (overlay.firstChild) {\r\n            overlay.removeChild(overlay.firstChild);\r\n        }\r\n\r\n        // Return early if there are no cues to process\r\n        if (!cues.length) {\r\n            return null;\r\n        }\r\n\r\n        var paddedOverlay = window.document.createElement('div');\r\n        // Added on 6/21/2016 by Evol Greaves: evol@jwplayer.com for styling captions with CSS\r\n        paddedOverlay.className = 'jw-text-track-container jw-reset';\r\n        paddedOverlay.style.position = 'absolute';\r\n        paddedOverlay.style.left = '0';\r\n        paddedOverlay.style.right = '0';\r\n        paddedOverlay.style.top = '0';\r\n        paddedOverlay.style.bottom = '0';\r\n        paddedOverlay.style.margin = CUE_BACKGROUND_PADDING;\r\n        overlay.appendChild(paddedOverlay);\r\n\r\n        // We don't need to recompute the cues' display states. Just reuse them.\r\n        if (!shouldCompute(cues) && !updateBoxPosition) {\r\n            for (var i = 0; i < cues.length; i++) {\r\n                paddedOverlay.appendChild(cues[i].displayState);\r\n            }\r\n            return;\r\n        }\r\n\r\n        var boxPositions = [];\r\n        var containerBox = BoxPosition.getSimpleBoxPosition(paddedOverlay);\r\n        var currentNumOfLines = cues.reduce(function(totalLines, cue) {\r\n            return totalLines + cue.text.split('\\n').length;\r\n        }, 0);\r\n\r\n        (function () {\r\n            for (var j = 0; j < cues.length; j++) {\r\n                var cue = cues[j];\r\n\r\n                // Compute the initial position and styles of the cue div.\r\n                var styleBox = new CueStyleBox(window, cue);\r\n                // Added on 6/21/2016 by Evol Greaves: evol@jwplayer.com for styling captions with CSS\r\n                styleBox.div.className = 'jw-text-track-display jw-reset';\r\n                paddedOverlay.appendChild(styleBox.div);\r\n\r\n                // Move the cue div to it's correct line position.\r\n                // Added on 08/03/2016 by Evol Greaves: evol@jwplayer.com for determining the correct\r\n                // position to place the containerBox.\r\n                moveBoxToLinePosition(window, styleBox, containerBox, boxPositions, currentNumOfLines);\r\n                currentNumOfLines -= cue.text.split('\\n').length;\r\n\r\n                // Remember the computed div so that we don't have to recompute it later\r\n                // if we don't have too.\r\n                cue.displayState = styleBox.div;\r\n\r\n                boxPositions.push(BoxPosition.getSimpleBoxPosition(styleBox));\r\n            }\r\n        }());\r\n    };\r\n\r\n    window.WebVTT || (window.WebVTT = WebVTT);\r\n});\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/polyfills/vtt.js\n **/"],"sourceRoot":""}