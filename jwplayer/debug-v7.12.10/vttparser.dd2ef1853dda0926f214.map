{"version":3,"sources":["webpack:///./src/js/parsers/captions/vttparser.js"],"names":["VTTCue","timestampRegex","integerRegex","fullLineRegex","noteRegex","removeTimestampRegex","colonDelimRegex","stringDelimRegex","whitespaceRegex","arrowRegex","headerRegex","requestFrame","window","requestAnimationFrame","rafFunction","setTimeout","VTTParser","decoder","state","buffer","StringDecoder","regionList","maxCueBatch","decode","data","Error","decodeURIComponent","encodeURIComponent","parseTimeStamp","input","computeSeconds","h","m","s","f","match","replace","Settings","values","Object","create","prototype","set","k","v","get","dflt","defaultKey","has","alt","a","n","length","integer","test","parseInt","percent","parseFloat","parseOptions","callback","keyValueDelim","groupDelim","groups","split","i","kv","defaults","center","align","parseCue","cue","oInput","consumeTimeStamp","ts","consumeCueSettings","settings","id","region","vals","vals0","vertical","line","lineAlign","snapToLines","size","position","skipWhitespace","startTime","substr","endTime","parse","flushing","self","stream","collectNextLine","pos","parseHeader","console","log","errorHandler","oncue","e","alreadyCollectedLine","currentCueBatch","processBuffer","flush","hasSubstring","text","undefined","onflush"],"mappings":"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","file":"vttparser.js","sourcesContent":["/*\r\n * Source: https://github.com/mozilla/vtt.js/blob/master/dist/vtt.js#L1716\r\n */\r\n\r\ndefine(['parsers/captions/vttcue'], function(VTTCue) {\r\n    var timestampRegex = /^(\\d+):(\\d{2})(:\\d{2})?\\.(\\d{3})/;\r\n    var integerRegex = /^-?\\d+$/;\r\n    var fullLineRegex = /\\r\\n|\\n/;\r\n    var noteRegex = /^NOTE($|[ \\t])/;\r\n    var removeTimestampRegex = /^[^\\sa-zA-Z-]+/;\r\n    var colonDelimRegex = /:/;\r\n    var stringDelimRegex = /\\s/;\r\n    var whitespaceRegex = /^\\s+/;\r\n    var arrowRegex = /-->/;\r\n    var headerRegex = /^WEBVTT([ \\t].*)?$/;\r\n    var requestFrame = window.requestAnimationFrame ||\r\n        function (rafFunction) {\r\n            return window.setTimeout(rafFunction, 17);\r\n        };\r\n\r\n    var VTTParser = function(window, decoder) {\r\n        this.window = window;\r\n        this.state = 'INITIAL';\r\n        this.buffer = '';\r\n        this.decoder = decoder || new StringDecoder();\r\n        this.regionList = [];\r\n        this.maxCueBatch = 1000;\r\n    };\r\n\r\n    function StringDecoder() {\r\n        return {\r\n            decode: function(data) {\r\n                if (!data) {\r\n                    return '';\r\n                }\r\n                if (typeof data !== 'string') {\r\n                    throw new Error('Error - expected string data.');\r\n                }\r\n                return decodeURIComponent(encodeURIComponent(data));\r\n            }\r\n        };\r\n    }\r\n\r\n    // Try to parse input as a time stamp.\r\n    function parseTimeStamp(input) {\r\n\r\n        function computeSeconds(h, m, s, f) {\r\n            return (h | 0) * 3600 + (m | 0) * 60 + (s | 0) + (f | 0) / 1000;\r\n        }\r\n\r\n        var m = input.match(timestampRegex);\r\n        if (!m) {\r\n            return null;\r\n        }\r\n\r\n        if (m[3]) {\r\n            // Timestamp takes the form of [hours]:[minutes]:[seconds].[milliseconds]\r\n            return computeSeconds(m[1], m[2], m[3].replace(':', ''), m[4]);\r\n        } else if (m[1] > 59) {\r\n            // Timestamp takes the form of [hours]:[minutes].[milliseconds]\r\n            // First position is hours as it's over 59.\r\n            return computeSeconds(m[1], m[2], 0, m[4]);\r\n        }\r\n        // Timestamp takes the form of [minutes]:[seconds].[milliseconds]\r\n        return computeSeconds(0, m[1], m[2], m[4]);\r\n    }\r\n\r\n    // A settings object holds key/value pairs and will ignore anything but the first\r\n    // assignment to a specific key.\r\n    function Settings() {\r\n        this.values = Object.create(null);\r\n    }\r\n\r\n    Settings.prototype = {\r\n        // Only accept the first assignment to any key.\r\n        set: function(k, v) {\r\n            if (!this.get(k) && v !== '') {\r\n                this.values[k] = v;\r\n            }\r\n        },\r\n        // Return the value for a key, or a default value.\r\n        // If 'defaultKey' is passed then 'dflt' is assumed to be an object with\r\n        // a number of possible default values as properties where 'defaultKey' is\r\n        // the key of the property that will be chosen; otherwise it's assumed to be\r\n        // a single value.\r\n        get: function(k, dflt, defaultKey) {\r\n            if (defaultKey) {\r\n                return this.has(k) ? this.values[k] : dflt[defaultKey];\r\n            }\r\n            return this.has(k) ? this.values[k] : dflt;\r\n        },\r\n        // Check whether we have a value for a key.\r\n        has: function(k) {\r\n            return k in this.values;\r\n        },\r\n        // Accept a setting if its one of the given alternatives.\r\n        alt: function(k, v, a) {\r\n            for (var n = 0; n < a.length; ++n) {\r\n                if (v === a[n]) {\r\n                    this.set(k, v);\r\n                    break;\r\n                }\r\n            }\r\n        },\r\n        // Accept a setting if its a valid (signed) integer.\r\n        integer: function(k, v) {\r\n            if (integerRegex.test(v)) { // integer\r\n                this.set(k, parseInt(v, 10));\r\n            }\r\n        },\r\n        // Accept a setting if its a valid percentage.\r\n        percent: function(k, v) {\r\n            v = parseFloat(v);\r\n            if (v >= 0 && v <= 100) {\r\n                this.set(k, v);\r\n                return true;\r\n            }\r\n            return false;\r\n        }\r\n    };\r\n\r\n    // Helper function to parse input into groups separated by 'groupDelim', and\r\n    // interprete each group as a key/value pair separated by 'keyValueDelim'.\r\n    function parseOptions(input, callback, keyValueDelim, groupDelim) {\r\n        var groups = groupDelim ? input.split(groupDelim) : [input];\r\n        for (var i = 0; i <= groups.length; i += 1) {\r\n            if (typeof groups[i] !== 'string') {\r\n                continue;\r\n            }\r\n            var kv = groups[i].split(keyValueDelim);\r\n            if (kv.length !== 2) {\r\n                continue;\r\n            }\r\n            var k = kv[0];\r\n            var v = kv[1];\r\n            callback(k, v);\r\n        }\r\n    }\r\n    \r\n    var defaults = new VTTCue(0, 0, 0);\r\n    // 'middle' was changed to 'center' in the spec: https://github.com/w3c/webvtt/pull/244\r\n    // Chrome and Safari don't yet support this change, but FF does\r\n    var center = defaults.align === 'middle' ? 'middle' : 'center';\r\n\r\n    function parseCue(input, cue, regionList) {\r\n        // Remember the original input if we need to throw an error.\r\n        var oInput = input;\r\n        // 4.1 WebVTT timestamp\r\n        function consumeTimeStamp() {\r\n            var ts = parseTimeStamp(input);\r\n            if (ts === null) {\r\n                throw new Error('Malformed timestamp: ' + oInput);\r\n            }\r\n            // Remove time stamp from input.\r\n            input = input.replace(removeTimestampRegex, '');\r\n            return ts;\r\n        }\r\n\r\n        // 4.4.2 WebVTT cue settings\r\n        function consumeCueSettings(input, cue) {\r\n            var settings = new Settings();\r\n\r\n            parseOptions(input, function (k, v) {\r\n                switch (k) {\r\n                    case 'region':\r\n                        // Find the last region we parsed with the same region id.\r\n                        for (var i = regionList.length - 1; i >= 0; i--) {\r\n                            if (regionList[i].id === v) {\r\n                                settings.set(k, regionList[i].region);\r\n                                break;\r\n                            }\r\n                        }\r\n                        break;\r\n                    case 'vertical':\r\n                        settings.alt(k, v, ['rl', 'lr']);\r\n                        break;\r\n                    case 'line':\r\n                        var vals = v.split(','),\r\n                            vals0 = vals[0];\r\n                        settings.integer(k, vals0);\r\n                        if (settings.percent(k, vals0)) {\r\n                            settings.set('snapToLines', false);\r\n                        }\r\n                        settings.alt(k, vals0, ['auto']);\r\n                        if (vals.length === 2) {\r\n                            settings.alt('lineAlign', vals[1], ['start', center, 'end']);\r\n                        }\r\n                        break;\r\n                    case 'position':\r\n                        vals = v.split(',');\r\n                        settings.percent(k, vals[0]);\r\n                        if (vals.length === 2) {\r\n                            settings.alt('positionAlign', vals[1], ['start', center, 'end', 'line-left', 'line-right', 'auto']);\r\n                        }\r\n                        break;\r\n                    case 'size':\r\n                        settings.percent(k, v);\r\n                        break;\r\n                    case 'align':\r\n                        settings.alt(k, v, ['start', center, 'end', 'left', 'right']);\r\n                        break;\r\n                }\r\n            }, colonDelimRegex, stringDelimRegex);\r\n\r\n            // Apply default values for any missing fields.\r\n            cue.region = settings.get('region', null);\r\n            cue.vertical = settings.get('vertical', '');\r\n            var line = settings.get('line', 'auto');\r\n            if (line === 'auto' && defaults.line === -1) {\r\n                // set numeric line number for Safari\r\n                line = -1;\r\n            }\r\n            cue.line = line;\r\n            cue.lineAlign = settings.get('lineAlign', 'start');\r\n            cue.snapToLines = settings.get('snapToLines', true);\r\n            cue.size = settings.get('size', 100);\r\n            cue.align = settings.get('align', center);\r\n            var position = settings.get('position', 'auto');\r\n            if (position === 'auto' && defaults.position === 50) {\r\n                // set numeric position for Safari\r\n                position = cue.align === 'start' || cue.align === 'left' ? 0 : cue.align === 'end' || cue.align === 'right' ? 100 : 50;\r\n            }\r\n            cue.position = position;\r\n        }\r\n\r\n        function skipWhitespace() {\r\n            input = input.replace(whitespaceRegex, '');\r\n        }\r\n\r\n        // 4.1 WebVTT cue timings.\r\n        skipWhitespace();\r\n        cue.startTime = consumeTimeStamp();   // (1) collect cue start time\r\n        skipWhitespace();\r\n        if (input.substr(0, 3) !== '-->') {     // (3) next characters must match '-->'\r\n            throw new Error('Malformed time stamp (time stamps must be separated by \\'-->\\'): ' +\r\n                oInput);\r\n        }\r\n        input = input.substr(3);\r\n        skipWhitespace();\r\n        cue.endTime = consumeTimeStamp();     // (5) collect cue end time\r\n\r\n        // 4.1 WebVTT cue settings list.\r\n        skipWhitespace();\r\n        consumeCueSettings(input, cue);\r\n    }\r\n\r\n    VTTParser.prototype = {\r\n        parse: function (data, flushing) {\r\n            var self = this;\r\n\r\n            // If there is no data then we won't decode it, but will just try to parse\r\n            // whatever is in buffer already. This may occur in circumstances, for\r\n            // example when flush() is called.\r\n            if (data) {\r\n                // Try to decode the data that we received.\r\n                self.buffer += self.decoder.decode(data, { stream: true });\r\n            }\r\n\r\n            function collectNextLine() {\r\n                var buffer = self.buffer;\r\n                var pos = 0;\r\n                while (pos < buffer.length && buffer[pos] !== '\\r' && buffer[pos] !== '\\n') {\r\n                    ++pos;\r\n                }\r\n                var line = buffer.substr(0, pos);\r\n                // Advance the buffer early in case we fail below.\r\n                if (buffer[pos] === '\\r') {\r\n                    ++pos;\r\n                }\r\n                if (buffer[pos] === '\\n') {\r\n                    ++pos;\r\n                }\r\n                self.buffer = buffer.substr(pos);\r\n                return line;\r\n            }\r\n\r\n            // 3.2 WebVTT metadata header syntax\r\n            function parseHeader(input) {\r\n                parseOptions(input, function (k, v) {\r\n                    switch (k) {\r\n                        case 'Region':\r\n                            // 3.3 WebVTT region metadata header syntax\r\n                            console.log('parse region', v);\r\n                            // parseRegion(v);\r\n                            break;\r\n                    }\r\n                }, colonDelimRegex);\r\n            }\r\n\r\n            function errorHandler() {\r\n                // If we are currently parsing a cue, report what we have.\r\n                if (self.state === 'CUETEXT' && self.cue && self.oncue) {\r\n                    self.oncue(self.cue);\r\n                }\r\n                self.cue = null;\r\n                // Enter BADWEBVTT state if header was not parsed correctly otherwise\r\n                // another exception occurred so enter BADCUE state.\r\n                self.state = self.state === 'INITIAL' ? 'BADWEBVTT' : 'BADCUE';\r\n            }\r\n\r\n            // 5.1 WebVTT file parsing.\r\n            try {\r\n                var line;\r\n                if (self.state === 'INITIAL') {\r\n                    // We can't start parsing until we have the first line.\r\n                    if (!fullLineRegex.test(self.buffer)) {\r\n                        return this;\r\n                    }\r\n\r\n                    line = collectNextLine();\r\n\r\n                    var m = line.match(headerRegex);\r\n                    if (!m || !m[0]) {\r\n                        throw new Error('Malformed WebVTT signature.');\r\n                    }\r\n                    self.state = 'HEADER';\r\n                }\r\n            } catch (e){\r\n                errorHandler();\r\n                return this;\r\n            }\r\n\r\n            var alreadyCollectedLine = false;\r\n            var currentCueBatch = 0;\r\n            function processBuffer() {\r\n                try {\r\n                    while (self.buffer && currentCueBatch <= self.maxCueBatch) {\r\n                        // We can't parse a line until we have the full line.\r\n                        if (!fullLineRegex.test(self.buffer)) {\r\n                            self.flush();\r\n                            return this;\r\n                        }\r\n\r\n                        if (!alreadyCollectedLine) {\r\n                            line = collectNextLine();\r\n                        } else {\r\n                            alreadyCollectedLine = false;\r\n                        }\r\n\r\n                        switch (self.state) {\r\n                            case 'HEADER':\r\n                                // 13-18 - Allow a header (metadata) under the WEBVTT line.\r\n                                if (colonDelimRegex.test(line)) {\r\n                                    parseHeader(line);\r\n                                } else if (!line) {\r\n                                    // An empty line terminates the header and starts the body (cues).\r\n                                    self.state = 'ID';\r\n                                }\r\n                                break;\r\n                            case 'NOTE':\r\n                                // Ignore NOTE blocks.\r\n                                if (!line) {\r\n                                    self.state = 'ID';\r\n                                }\r\n                                break;\r\n                            case 'ID':\r\n                                // Check for the start of NOTE blocks.\r\n                                if (noteRegex.test(line)) {\r\n                                    self.state = 'NOTE';\r\n                                    break;\r\n                                }\r\n                                // 19-29 - Allow any number of line terminators, then initialize new cue values.\r\n                                if (!line) {\r\n                                    break;\r\n                                }\r\n                                self.cue = new VTTCue(0, 0, '');\r\n                                self.state = 'CUE';\r\n                                // 30-39 - Check if self line contains an optional identifier or timing data.\r\n                                if (!arrowRegex.test(line)) {\r\n                                    self.cue.id = line;\r\n                                    break;\r\n                                }\r\n                            // Process line as start of a cue.\r\n                            /* falls through*/\r\n                            case 'CUE':\r\n                                // 40 - Collect cue timings and settings.\r\n                                try {\r\n                                    parseCue(line, self.cue, self.regionList);\r\n                                } catch (e) {\r\n                                    // In case of an error ignore rest of the cue.\r\n                                    self.cue = null;\r\n                                    self.state = 'BADCUE';\r\n                                    break;\r\n                                }\r\n                                self.state = 'CUETEXT';\r\n                                break;\r\n                            case 'CUETEXT':\r\n                                var hasSubstring = arrowRegex.test(line);\r\n                                // 34 - If we have an empty line then report the cue.\r\n                                // 35 - If we have the special substring '-->' then report the cue,\r\n                                // but do not collect the line as we need to process the current\r\n                                // one as a new cue.\r\n                                if (!line || hasSubstring && (alreadyCollectedLine = true)) {\r\n                                    // We are done parsing self cue.\r\n                                    if (self.oncue) {\r\n                                        currentCueBatch += 1;\r\n                                        self.oncue(self.cue);\r\n                                    }\r\n                                    self.cue = null;\r\n                                    self.state = 'ID';\r\n                                    break;\r\n                                }\r\n                                if (self.cue.text) {\r\n                                    self.cue.text += '\\n';\r\n                                }\r\n                                self.cue.text += line;\r\n                                break;\r\n                            case 'BADCUE': // BADCUE\r\n                                // 54-62 - Collect and discard the remaining cue.\r\n                                if (!line) {\r\n                                    self.state = 'ID';\r\n                                }\r\n                                break;\r\n                        }\r\n                    }\r\n\r\n                    currentCueBatch = 0;\r\n                    if (self.buffer) {\r\n                        requestFrame(processBuffer);\r\n                    } else if (!flushing) {\r\n                        self.flush();\r\n                        return this;\r\n                    }\r\n                } catch (e) {\r\n                    errorHandler(e);\r\n                    return this;\r\n                }\r\n            }\r\n\r\n            // Immediately process some cues\r\n            processBuffer();\r\n        },\r\n        flush: function () {\r\n            var self = this;\r\n            try {\r\n                // Finish decoding the stream.\r\n                self.buffer += self.decoder.decode();\r\n                // Synthesize the end of the current cue or region.\r\n                if (self.cue || self.state === 'HEADER') {\r\n                    self.buffer += '\\n\\n';\r\n                    self.parse(undefined, true);\r\n                }\r\n                // If we've flushed, parsed, and we're still on the INITIAL state then\r\n                // that means we don't have enough of the stream to parse the first\r\n                // line.\r\n                if (self.state === 'INITIAL') {\r\n                    throw new Error('Malformed WebVTT signature.');\r\n                }\r\n            } catch(e) {\r\n                throw e;\r\n            }\r\n            if (self.onflush) {\r\n                self.onflush();\r\n            }\r\n            return this;\r\n        }\r\n    };\r\n\r\n    return VTTParser;\r\n});\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/parsers/captions/vttparser.js\n **/"],"sourceRoot":""}